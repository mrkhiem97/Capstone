@model MobileSurveillanceWebApplication.Models.ViewModel.TrajectoryViewModel

@{
    ViewBag.Title = "ViewDetail";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@******************************@


<script type="text/javascript">
    var locationList;
    var poly;
    var map;

    

    $(document).ready(function () {

        // Initialize the map.
        function initialize() {
            // Center point
            var myLatLng = new google.maps.LatLng(10.820682, 106.661579);
            // Map Opttions
            var mapOptions = {
                center: myLatLng,
                zoom: 16,
                width: 900
            };
            // The map
            map = new google.maps.Map(document.getElementById("map-canvas"),
                mapOptions);

            var lineArr = [];
            var LngAvg;
            var SumLng = 0;
            var LatAvg;
            var SumLat = 0;
            var count = 0;
            var latlngbounds = new google.maps.LatLngBounds()

            // Get location list 
            $.getJSON("/Trajectory/GetLocationList/", { trajectId: '@Model.Id' }, function (data) {
                locationList = data;
                $.each(data, function (index, value) {

                    var point = new google.maps.LatLng(value.Latitude, value.Longitude);
                    latlngbounds.extend(point);

                    // For calculating center point
                    SumLng += value.Longitude;
                    SumLat += value.Latitude;
                    count = index;

                    lineArr.push(point);

                    var marker = new MarkerWithLabel({
                        position: point,
                        draggable: false,
                        map: map,
                        labelText: (index + 1),
                        labelClass: "labels", // the CSS class for the label
                        labelStyle: { opacity: 0.75 },
                        labelVisible: true,
                        
                    });

                    //var marker = new MarkerWithLabel({
                    //    position: point,
                    //    map: map,
                    //    draggable: false,
                    //    labelContent: value.CreatedDate,
                    //    //labelAnchor: new google.maps.Point(0, 0),
                    //    labelClass: "labels", // the CSS class for the label
                    //    labelStyle: { opacity: 1 },
                    //});

                    var image = {
                        url: '../Images/marker.png',
                        size: new google.maps.Size(32, 32),
                    }

                    var marker = new google.maps.Marker({
                        position: point,
                        map: map,
                        icon: '../Images/marker.png',
                        title: value.CreatedDate
                    });
                    

                    var address = "";
                    

                    google.maps.event.addListener(marker, 'click', (function (marker) {

                        geocoder = new google.maps.Geocoder();
                        geocoder.geocode({ 'latLng': point }, function (results, status) {
                            if (status == google.maps.GeocoderStatus.OK) {
                                if (results[1]) {
                                    address = results[1].formatted_address;
                                }
                            } else {
                                //alert("Geocoder failed due to: " + status);
                            }
                        });
                        var itemHtml = $("#slider-item").html();
                        var activeItemHtml = $("#slider-active-item").html();
                        var modalHtml = $("#modalbox1").html();
                        var modal = $("#modalbox1");

                        return function () {

                            var collectionItems = "";
                            var contentString = "";
                            var modelContent = "";
                            $.getJSON("/Trajectory/GetImgList/", { locateId: value.id }, function (data) {
                                var tempItem = activeItemHtml;
                                tempItem = tempItem.replace("{item-link}", data[0]);
                                collectionItems += tempItem;
                                for (var i = 1; i < data.length; i++) {
                                    var tempItem = itemHtml;
                                    tempItem = tempItem.replace("{item-link}", data[i]);
                                    collectionItems += tempItem;
                                }
                                modelContent = modalHtml.replace("{slider-item}", collectionItems);
                                modal.html(modelContent);
                            })
                            modal.modal("show");
                        }
                    })(marker));
                });

                var polyOption = {
                    geodesic: true,
                    strokeColor: '#FF0000',
                    strokeOpacity: 1.0,
                    strokeWeight: 2
                };
                poly = new google.maps.Polyline(polyOption);
                poly.setMap(map);
                var path = poly.getPath();
                for (var i = 0; i < lineArr.length; i++) {
                    path.push(lineArr[i]);
                }

                map.setCenter(new google.maps.LatLng(SumLat / (count + 1), SumLng / (count + 1)));
                map.fitBounds(latlngbounds);
            });





        }
        google.maps.event.addDomListener(window, 'load', initialize);

        $("#line").click(function () {
            var $this = $(this);
            // $this will contain a reference to the checkbox
            if ($this.is(':checked')) {
                poly.setMap(map);
            } else {
                poly.setMap(null);
            }
        });
        $("#test").click(function () {
            var modal = $("#modalbox1");
            modal.modal("show");
        });

    });



</script>
@******************************@

<h2>ViewDetail</h2>


<style type="text/css">
    #map-canvas {
        height: 500px;
        width: 900px;
    }

    /*#panel {
        position: absolute;
        top: 5px;
        left: 50%;
        margin-left: -180px;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
    }*/
</style>

<div id="slider-active-item" style="display:none">

    <div class="item active">
        <img src="{item-link}" alt="item-alt" style="width: 560px; height:400px">
        <div class="carousel-caption">
        </div>
    </div>

</div>

<div id="slider-item" style="display:none">
    <div class="item">
        <img src="{item-link}" alt="item-alt" style="width: 560px; height:400px">
        <div class="carousel-caption">
        </div>
    </div>

</div>



<div class="modal fade" id="modalbox1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Captured image</h4>
            </div>
            <div class="modal-body">
                <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#carousel-example-generic" data-slide-to="0" class=""></li>
                        <li data-target="#carousel-example-generic" data-slide-to="1" class=""></li>
                        <li data-target="#carousel-example-generic" data-slide-to="2" class="active"></li>
                    </ol>
                    <div class="carousel-inner">
                        {slider-item}
                    </div>
                    <a class="left carousel-control" href="#carousel-example-generic" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left"></span>
                    </a>
                    <a class="right carousel-control" href="#carousel-example-generic" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right"></span>
                    </a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div id="panel">
    Line
    <input type="checkbox" id="line" checked="checked" />
</div>
<div id="map-canvas" />
<script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9aFiBetpU1mIBG65QpO8LzYslOhdQyXE&sensor=true">
</script>
<script src="/Scripts/markerwithlabel.js"></script>

